import { store } from '../data/state';
import { Car } from '../types/interfaces';
import { getCars } from '../data/api';
import { CAR_IN_PAGE, FIRST_PAGE } from '../utils/constants';

export function renderGarage() {
    return `
  <h1>GARAGE (<span class="garage__count">${store.carsCount}</span>)</h1>
  <h2>PAGE <span class="garage__page">${store.carsPage}</span></h2>
  <ul class="cars">
  ${store.cars.map((car) => `<li class="car">${renderCarTrack(car)}</li>`).join('')}
  </ul>
  `;
}

function renderCarTrack(car: Car) {
    return `
  <div class="car-controls">
    <button class="select-button" type="button" data-select="${car.id}">SELECT</button>
    <button class="remove-button" type="button" data-remove="${car.id}">REMOVE</button>
  <div class="control-buttons">
    <button class="start-button" type="button" data-start="${car.id}">A</button>
    <button class="stop-button" type="button" data-stop="${car.id}">B</button>
  </div>
  <h3 class="car-name">${car.name}</h3>
</div>
<div class="track" data-track="${car.id}">
  <div class="car-wrapper" ><div class="car-image" data-car="${car.id}">${renderCarImage(car.color)}</div></div>
  <div class="flag" data-flag="${car.id}" >${flag}</div>
</div>
  `;
}

function renderCarImage(color: string) {
    return `
    <svg width="110" height="40" viewBox="0 0 110 40" xmlns="http://www.w3.org/2000/svg" class='car-img'>
        <g stroke="none" fill="${color}">
            <path
                d="M24.2793 28.9143C23.8263 28.9143 23.4586 29.2949 23.4586 29.7636C23.4586 30.2324 23.8263 30.609 24.2793 30.609C24.7322 30.609 25.0961 30.2324 25.0961 29.7636C25.0961 29.2949 24.7322 28.9143 24.2793 28.9143ZM24.2793 31.3221C24.0857 31.3221 23.9309 31.4824 23.9309 31.6787C23.9309 31.879 24.0857 32.0393 24.2793 32.0393C24.4689 32.0393 24.6238 31.879 24.6238 31.6787C24.6238 31.4824 24.4689 31.3221 24.2793 31.3221ZM25.1967 32.4239V35.3365C26.0212 35.1923 26.78 34.8558 27.4342 34.375L25.4445 32.3197C25.367 32.3558 25.2819 32.3918 25.1967 32.4239ZM26.749 30.9695L28.7349 33.0288C29.1994 32.3518 29.5245 31.5665 29.6639 30.7131H26.8496C26.8187 30.8013 26.7838 30.8894 26.749 30.9695ZM26.749 28.5537C26.7838 28.6378 26.8187 28.722 26.8496 28.8101H29.6639C29.5245 27.9567 29.1994 27.1715 28.7349 26.4944L26.749 28.5537ZM23.1102 27.2075C23.1915 27.1675 23.2728 27.1314 23.358 27.0994V24.1907C22.5334 24.3349 21.7747 24.6675 21.1205 25.1482L23.1102 27.2075ZM24.2793 20.5048C19.3359 20.5048 15.3332 24.6514 15.3332 29.7636C15.3332 34.8758 19.3359 39.0224 24.2793 39.0224C29.2187 39.0224 33.2214 34.8758 33.2214 29.7636C33.2214 24.6514 29.2187 20.5048 24.2793 20.5048ZM24.2793 36.3742C20.7489 36.3742 17.8881 33.4135 17.8881 29.7636C17.8881 26.1098 20.7489 23.149 24.2793 23.149C27.8058 23.149 30.6665 26.1098 30.6665 29.7636C30.6665 33.4135 27.8058 36.3742 24.2793 36.3742ZM24.2793 28.2051C24.4689 28.2051 24.6238 28.0409 24.6238 27.8445C24.6238 27.6442 24.4689 27.484 24.2793 27.484C24.0857 27.484 23.9309 27.6442 23.9309 27.8445C23.9309 28.0409 24.0857 28.2051 24.2793 28.2051ZM27.4342 25.1482C26.78 24.6675 26.0212 24.3349 25.1967 24.1907V27.0994C25.2819 27.1314 25.367 27.1675 25.4445 27.2075L27.4342 25.1482ZM21.8095 28.5537L19.8198 26.4944C19.3553 27.1715 19.034 27.9567 18.8946 28.8101H21.705C21.736 28.722 21.7708 28.6378 21.8095 28.5537ZM21.1205 34.375C21.7747 34.8558 22.5334 35.1923 23.358 35.3365V32.4239C23.2728 32.3918 23.1915 32.3558 23.1102 32.3197L21.1205 34.375ZM21.705 30.7131H18.8946C19.034 31.5665 19.3553 32.3518 19.8198 33.0288L21.8095 30.9695C21.7708 30.8894 21.736 30.8013 21.705 30.7131ZM22.7734 29.7636C22.7734 29.5633 22.6147 29.403 22.425 29.403C22.2315 29.403 22.0766 29.5633 22.0766 29.7636C22.0766 29.9599 22.2315 30.1202 22.425 30.1202C22.6147 30.1202 22.7734 29.9599 22.7734 29.7636ZM25.7851 29.7636C25.7851 29.9599 25.9399 30.1202 26.1296 30.1202C26.3232 30.1202 26.478 29.9599 26.478 29.7636C26.478 29.5633 26.3232 29.403 26.1296 29.403C25.9399 29.403 25.7851 29.5633 25.7851 29.7636ZM93.6061 28.9143C93.1531 28.9143 92.7854 29.2949 92.7854 29.7636C92.7854 30.2324 93.1531 30.609 93.6061 30.609C94.0551 30.609 94.4228 30.2324 94.4228 29.7636C94.4228 29.2949 94.0551 28.9143 93.6061 28.9143ZM92.437 27.2075C92.5183 27.1675 92.5996 27.1314 92.6847 27.0994V24.1907C91.8602 24.3349 91.1015 24.6675 90.4473 25.1482L92.437 27.2075ZM93.6061 31.3221C93.4125 31.3221 93.2577 31.4824 93.2577 31.6787C93.2577 31.879 93.4125 32.0393 93.6061 32.0393C93.7957 32.0393 93.9506 31.879 93.9506 31.6787C93.9506 31.4824 93.7957 31.3221 93.6061 31.3221ZM94.5235 32.4239V35.3365C95.348 35.1923 96.1068 34.8558 96.761 34.375L94.7712 32.3197C94.6899 32.3558 94.6087 32.3918 94.5235 32.4239ZM96.1764 30.7131C96.1455 30.8013 96.1106 30.8894 96.0719 30.9695L98.0616 33.0288C98.5262 32.3518 98.8513 31.5665 98.9907 30.7131H96.1764ZM109.168 18.9944C107.952 17.0713 104.844 16.4022 102.475 15.601C85.9414 11.4663 80.4406 12.8125 77.6805 12.4078C77.1231 12.2556 76.6276 11.7508 76.1747 11.4583C75.1759 10.8173 74.1385 10.2484 73.1552 9.6274C71.5294 8.59375 64.0312 4.35096 62.0027 3.58173C57.551 1.89903 50.5057 0.548875 33.535 1.95513C32.8459 1.75881 32.4317 1.18189 31.7001 1.00561C30.9762 0.825318 30.3104 1.22195 29.7994 1.34214C29.8071 1.91907 29.7568 2.38782 29.6678 2.83654C26.3503 4.28285 22.9941 5.39663 19.6959 6.84295C18.3217 7.44791 16.901 8.03686 15.4997 8.67388C14.6248 9.07051 13.7926 9.63541 12.8093 9.96394C11.7409 10.3205 10.5718 10.1603 9.39891 10.4407C7.25822 10.9495 4.93945 11.0176 2.57424 11.0497C2.30713 11.5304 1.83487 12.0152 1.7226 12.6122C2.13294 12.7444 2.26842 13.0369 2.24907 13.6298C1.52518 14.7396 1.71873 16.3221 1.7226 18.113C0.181924 18.9303 -0.054212 21.9191 0.344507 24.2909C0.301926 24.4952 0.259345 24.6955 0.212892 24.8998C0.298055 25.5689 0.507092 26.278 0.541932 27.0072C1.12259 27.4078 1.7768 28.0529 2.18326 28.6338C2.38068 28.9183 2.47746 29.407 2.83747 29.5152C4.773 30.9816 14.5784 31.282 14.5784 31.282L15.0971 31.3101C15.0158 30.8053 14.9732 30.2885 14.9732 29.7636C14.9732 24.4431 19.1385 20.1322 24.2793 20.1322C29.4162 20.1322 33.5814 24.4431 33.5814 29.7636C33.5814 30.657 33.4614 32.1074 33.2446 32.9247L84.7839 32.8325C84.4704 31.867 84.3 30.8373 84.3 29.7636C84.3 24.4431 88.4653 20.1362 93.6022 20.1362C98.7429 20.1362 102.908 24.4431 102.908 29.7636C102.908 30.6931 102.78 31.5945 102.54 32.4479L103.067 32.4359C103.067 32.4359 107.128 32.2316 108.119 31.7588C109.11 31.282 109.497 29.9239 109.497 29.9239L109.234 27.0753C109.234 27.0713 110.453 21.0296 109.168 18.9944ZM26.8458 12.0032C23.7644 9.88381 25.398 7.40785 25.3128 7.41586C25.2625 7.45993 25.2277 7.49599 25.2044 7.52003C25.2703 7.44791 25.3051 7.41586 25.3128 7.41586C26.1064 6.68269 30.6394 3.40545 46.7198 3.38141C47.223 6.29807 47.7263 10.1322 48.2295 13.0529C41.761 12.8486 29.0252 12.9647 26.8458 12.0032ZM68.3009 13.0889C66.888 13.0889 52.8206 13.0849 52.8206 13.0849C52.8206 13.0849 50.5521 6.88702 49.7392 3.44952C49.8321 3.45753 52.6232 3.58573 52.6232 3.58573C52.6232 3.58573 58.151 4.23477 61.6118 5.41666C64.3331 6.34615 69.7061 10.0841 69.8107 10.3045C68.1926 10.3926 67.8093 11.7107 68.3009 13.0889ZM93.6061 20.5048C88.6627 20.5048 84.66 24.6514 84.66 29.7636C84.66 34.8758 88.6627 39.0224 93.6061 39.0224C98.5455 39.0224 102.548 34.8758 102.548 29.7636C102.548 24.6514 98.5455 20.5048 93.6061 20.5048ZM93.6061 36.3742C90.0756 36.3742 87.2149 33.4135 87.2149 29.7636C87.2149 26.1098 90.0756 23.149 93.6061 23.149C97.1326 23.149 99.9933 26.1098 99.9933 29.7636C99.9933 33.4135 97.1326 36.3742 93.6061 36.3742ZM91.1363 28.5537L89.1466 26.4944C88.6821 27.1715 88.3569 27.9567 88.2175 28.8101H91.0318C91.0628 28.722 91.0976 28.6378 91.1363 28.5537ZM92.0963 29.7636C92.0963 29.5633 91.9415 29.403 91.7518 29.403C91.5583 29.403 91.4034 29.5633 91.4034 29.7636C91.4034 29.9599 91.5583 30.1202 91.7518 30.1202C91.9415 30.1202 92.0963 29.9599 92.0963 29.7636ZM93.6061 28.2051C93.7957 28.2051 93.9506 28.0409 93.9506 27.8445C93.9506 27.6442 93.7957 27.484 93.6061 27.484C93.4125 27.484 93.2577 27.6442 93.2577 27.8445C93.2577 28.0409 93.4125 28.2051 93.6061 28.2051ZM96.761 25.1482C96.1068 24.6675 95.348 24.3349 94.5235 24.1907V27.0994C94.6087 27.1314 94.6899 27.1675 94.7712 27.2075L96.761 25.1482ZM95.1119 29.7636C95.1119 29.9599 95.2667 30.1202 95.4564 30.1202C95.65 30.1202 95.8048 29.9599 95.8048 29.7636C95.8048 29.5633 95.65 29.403 95.4564 29.403C95.2667 29.403 95.1119 29.5633 95.1119 29.7636ZM90.4473 34.375C91.1015 34.8558 91.8602 35.1923 92.6847 35.3365V32.4239C92.5996 32.3918 92.5183 32.3558 92.437 32.3197L90.4473 34.375ZM91.0318 30.7131H88.2175C88.3569 31.5665 88.6821 32.3518 89.1466 33.0288L91.1363 30.9695C91.0976 30.8894 91.0628 30.8013 91.0318 30.7131ZM96.1764 28.8101H98.9907C98.8513 27.9567 98.5262 27.1715 98.0616 26.4944L96.0719 28.5537C96.1106 28.6378 96.1455 28.722 96.1764 28.8101Z"
            />
        </g>
    </svg>
`;
}

const flag = `
    <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="#b52450"
        height="60px"
        width="60px"
        viewBox="0 0 60 60"
    >
        <path
            d="M51.371,3.146c-0.203-0.081-5.06-1.997-10.815-1.997c-3.434,0-6.47,0.687-9.024,2.042C29.269,4.392,26.199,5,22.407,5 C17.099,5,11.865,3.788,10,3.307V1c0-0.553-0.447-1-1-1S8,0.447,8,1v3c0,0.014,0.007,0.026,0.008,0.04C8.008,4.052,8,4.062,8,4.074 V33v1.074V59c0,0.553,0.447,1,1,1s1-0.447,1-1V35.373C12.273,35.937,17.243,37,22.407,37c4.122,0,7.507-0.688,10.062-2.042 c2.263-1.201,4.983-1.81,8.087-1.81c5.357,0,10.027,1.836,10.073,1.854c0.309,0.124,0.657,0.086,0.932-0.102 C51.835,34.716,52,34.406,52,34.074v-30C52,3.665,51.751,3.298,51.371,3.146z"
        />
    </svg>
`;

async function updateGarage() {
    const nextPage = document.querySelector('.next-button') as HTMLButtonElement;
    const prevPage = document.querySelector('.prev-button') as HTMLButtonElement;

    const { cars, count } = await getCars(store.carsPage);
    store.cars = cars;
    store.carsCount = Number(count);

    const lastPage = store.carsCount / CAR_IN_PAGE;
    nextPage.disabled = store.carsPage >= lastPage;
    prevPage.disabled = store.carsPage <= FIRST_PAGE;
}

export { renderCarImage, updateGarage };
